---
import { actions } from "astro:actions";
import StoreLayout from "../../layouts/StoreLayout.astro";

const { slug } = Astro.params;

if (!slug) {
    return new Response('Product not found', { status: 404 });
}

const { data, error } = await Astro.callAction(actions.products.getProduct,{ productId: slug });

const product = data?.product

---

<StoreLayout>
  <section class="px-4 pb-12">
    <img src={product?.images[0]} alt={product?.name} class="mx-auto w-full max-w-lg" />

    <h1 class="mt-8 text-6xl text-center text-gray-900 font-semibold">{product?.name}</h1>
    <p class="mt-12 text-lg text-center text-gray-600 text-balance whitespace-pre-line">{product?.description}</p>

    <h2 class="mt-12 text-4xl text-center text-gray-900 font-semibold">
      ${typeof product?.default_price === "object"
        ? product?.default_price?.unit_price
        : product?.default_price}
    </h2>

    <div class="mt-8 flex items-center justify-center gap-4">
      <button class="mt-2 w-fit px-8 py-2 min-h-8 flex items-center justify-center gap-2 text-white bg-gray-950 hover:bg-orange-600 hover:cursor-pointer hover:scale-110 rounded-full transition-all duration-500 ease-in-out">
        Add to cart
      </button>
      {product?.metadata.source && 
        <a 
          href={product?.metadata.source} target="_blank" rel="noopener noreferrer"
          class="mt-2 w-fit px-8 py-2 min-h-8 flex items-center justify-center gap-2 text-gray-900 hover:text-orange-600 bg-transparent hover:bg-orange-200/40 border border-transparent hover:border-orange-300 hover:cursor-pointer rounded-full transition-all duration-300 ease-in-out">
          Learn More
        </a>
      }
    </div>

  </section>
</StoreLayout>
